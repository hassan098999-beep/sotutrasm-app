<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOTUTRASM PRO V8.1</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        
        .premium-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
        
        .active-tab { background-color: #2563eb !important; color: white !important; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        
        .engine-progress { height: 8px; border-radius: 4px; background: #e5e7eb; overflow: hidden; }
        .engine-progress-bar { height: 100%; background: linear-gradient(90deg, #3b82f6, #2563eb); transition: width 0.5s ease; }
        
        .btn-action { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-action:active { transform: scale(0.95); }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <div id="view-auth" class="min-h-screen flex items-center justify-center p-6 bg-slate-50">
        <div class="w-full max-w-md text-center">
            <div class="mb-8">
                <div class="w-20 h-20 bg-blue-600 rounded-3xl mx-auto flex items-center justify-center shadow-xl shadow-blue-200 mb-4">
                    <i class="fas fa-ship text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-extrabold tracking-tight text-slate-900">SOTUTRASM</h1>
                <p class="text-slate-500 font-medium">Smart Dredging Solutions</p>
            </div>
            <div class="premium-card p-8 space-y-4">
                <input type="email" id="auth-email" class="w-full p-4 rounded-2xl bg-white border border-slate-200 outline-none focus:border-blue-500" placeholder="Email" value="admin@sotutrasm.com">
                <input type="password" id="auth-pass" class="w-full p-4 rounded-2xl bg-white border border-slate-200 outline-none focus:border-blue-500" placeholder="Mot de passe" value="admin123">
                <button onclick="handleAuth()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-black btn-action">Se Connecter</button>
            </div>
        </div>
    </div>

    <div id="view-selection" class="hidden min-h-screen flex flex-col items-center justify-center p-6">
        <h2 class="text-2xl font-bold mb-8 text-slate-800">Sélectionner l'Unité</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 w-full max-w-2xl">
            <button onclick="initApp('Blue Shark')" class="premium-card p-10 hover:border-blue-500 hover:scale-[1.02] btn-action group">
                <div class="w-16 h-16 bg-blue-100 rounded-2xl mx-auto flex items-center justify-center mb-4 group-hover:bg-blue-600 transition-colors">
                    <i class="fas fa-water text-blue-600 group-hover:text-white text-2xl"></i>
                </div>
                <span class="text-xl font-extrabold text-slate-800">Blue Shark</span>
            </button>
            <button onclick="initApp('White Shark')" class="premium-card p-10 hover:border-blue-500 hover:scale-[1.02] btn-action group">
                <div class="w-16 h-16 bg-slate-100 rounded-2xl mx-auto flex items-center justify-center mb-4 group-hover:bg-blue-600 transition-colors">
                    <i class="fas fa-anchor text-slate-600 group-hover:text-white text-2xl"></i>
                </div>
                <span class="text-xl font-extrabold text-slate-800">White Shark</span>
            </button>
        </div>
    </div>

    <div id="view-main" class="hidden">
        <header class="bg-white/80 backdrop-blur-md border-b border-slate-100 sticky top-0 z-50 p-4">
            <div class="max-w-xl mx-auto flex justify-between items-center">
                <div>
                    <span id="active-drague-name" class="text-[10px] font-bold text-blue-600 uppercase tracking-[0.2em]">BLUE SHARK</span>
                    <h1 class="text-xl font-black text-slate-900">Dashboard</h1>
                </div>
                <div id="global-timer" class="px-4 py-2 bg-red-50 text-red-600 rounded-full font-mono font-black border border-red-100">00:00:00</div>
            </div>
        </header>

        <main class="p-4 max-w-xl mx-auto space-y-6">
            
            <div id="tab-ops-view" class="tab-pane space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="startSession()" class="bg-green-500 text-white p-5 rounded-3xl font-bold shadow-lg shadow-green-100 btn-action"><i class="fas fa-play mr-2"></i>Démarrer</button>
                    <button onclick="stopSession()" class="bg-white text-red-500 border border-red-100 p-5 rounded-3xl font-bold btn-action"><i class="fas fa-stop mr-2"></i>Arrêter</button>
                </div>

                <div class="premium-card p-6 space-y-4">
                    <h3 class="font-bold text-slate-800">Saisie des Opérations</h3>
                    <input type="text" id="op-chauffeur" class="w-full p-4 rounded-xl bg-slate-50 border border-slate-100" placeholder="Chauffeur">
                    <div class="grid grid-cols-3 gap-3">
                        <input type="number" id="op-long" class="p-4 rounded-xl bg-slate-50 border border-slate-100 text-center" placeholder="L">
                        <input type="number" id="op-larg" class="p-4 rounded-xl bg-slate-50 border border-slate-100 text-center" placeholder="l">
                        <input type="number" id="op-prof" class="p-4 rounded-xl bg-slate-50 border border-slate-100 text-center" placeholder="P">
                    </div>
                    <button onclick="saveOperation()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold btn-action">Synchroniser Opération</button>
                </div>
            </div>

            <div id="tab-moteurs-view" class="tab-pane hidden space-y-4">
                <div id="engine-container" class="space-y-4">
                    </div>
            </div>

            <div id="tab-fuel-view" class="tab-pane hidden space-y-4">
                <div class="premium-card p-8 bg-slate-900 text-white text-center">
                    <p class="text-xs text-slate-400 uppercase font-bold tracking-widest">Stock Carburant</p>
                    <h2 class="text-5xl font-black mt-2">14,250 <small class="text-lg">L</small></h2>
                </div>
                <div class="premium-card p-6">
                    <h3 class="font-bold mb-4">Ravitaillement</h3>
                    <input type="number" class="w-full p-4 rounded-xl bg-slate-50 border border-slate-100 mb-4" placeholder="Quantité (L)">
                    <button class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold btn-action">Ajouter au Stock</button>
                </div>
            </div>

        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-lg border-t border-slate-100 p-3 px-6 flex justify-between items-center z-50">
            <button onclick="switchTab('ops')" id="btn-ops" class="p-3 px-5 rounded-2xl text-slate-400 font-bold flex flex-col items-center active-tab"><i class="fas fa-layer-group mb-1"></i><span class="text-[9px] uppercase">Ops</span></button>
            <button onclick="switchTab('moteurs')" id="btn-moteurs" class="p-3 px-5 rounded-2xl text-slate-400 font-bold flex flex-col items-center"><i class="fas fa-engine mb-1"></i><span class="text-[9px] uppercase">Moteurs</span></button>
            <button onclick="switchTab('fuel')" id="btn-fuel" class="p-3 px-5 rounded-2xl text-slate-400 font-bold flex flex-col items-center"><i class="fas fa-gas-pump mb-1"></i><span class="text-[9px] uppercase">Fuel</span></button>
            <button onclick="location.reload()" class="p-3 px-5 rounded-2xl text-red-400 font-bold flex flex-col items-center"><i class="fas fa-power-off mb-1"></i><span class="text-[9px] uppercase">Quitter</span></button>
        </nav>
    </div>

    <script>
        // FIREBASE CONFIG (Already provided by you)
        const firebaseConfig = {
            apiKey: "AIzaSyBJxyFwFseINtXqdEU0JYESl6zQYVj0hSw",
            authDomain: "sotutrasm-manager.firebaseapp.com",
            projectId: "sotutrasm-manager",
            storageBucket: "sotutrasm-manager.firebasestorage.app",
            messagingSenderId: "452756329466",
            appId: "1:452756329466:web:8c5b54a2818e4602874a43"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let currentUnit = "";
        let timerInterval = null;
        let seconds = 0;

        function handleAuth() {
            document.getElementById('view-auth').classList.add('hidden');
            document.getElementById('view-selection').classList.remove('hidden');
        }

        function initApp(unit) {
            currentUnit = unit;
            document.getElementById('view-selection').classList.add('hidden');
            document.getElementById('view-main').classList.remove('hidden');
            document.getElementById('active-drague-name').innerText = unit;
            renderEngines();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-pane').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tab}-view`).classList.remove('hidden');
            
            // UI Toggle
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('active-tab'));
            document.getElementById(`btn-${tab}`).classList.add('active-tab');
        }

        function renderEngines() {
            const container = document.getElementById('engine-container');
            const engines = currentUnit === "Blue Shark" ? ["CAT C32", "CAT 3406", "IVECO"] : ["CAT 3512"];
            
            container.innerHTML = engines.map(name => `
                <div class="premium-card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-extrabold text-slate-800">${name}</h4>
                        <span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded-lg font-bold">ACTIF</span>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between text-xs font-bold">
                            <span class="text-slate-400 uppercase">Prochaine Vidange</span>
                            <span class="text-blue-600">180 / 250 H</span>
                        </div>
                        <div class="engine-progress">
                            <div class="engine-progress-bar" style="width: 72%"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" class="w-full p-3 rounded-xl bg-slate-50 border border-slate-100 text-sm" placeholder="Heures">
                            <button class="bg-slate-100 text-slate-700 py-3 rounded-xl text-xs font-bold btn-action">Vidange Done</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function startSession() {
            if(timerInterval) return;
            timerInterval = setInterval(() => {
                seconds++;
                let h = Math.floor(seconds/3600).toString().padStart(2,'0');
                let m = Math.floor((seconds%3600)/60).toString().padStart(2,'0');
                let s = (seconds%60).toString().padStart(2,'0');
                document.getElementById('global-timer').innerText = `${h}:${m}:${s}`;
            }, 1000);
        }

        function stopSession() {
            clearInterval(timerInterval);
            timerInterval = null;
            alert("Opération terminée et sauvegardée !");
        }

        function saveOperation() {
            const v = document.getElementById('op-long').value;
            if(!v) return alert("Veuillez saisir les données");
            alert("Données synchronisées avec succès !");
        }
    </script>
</body>
</html>
